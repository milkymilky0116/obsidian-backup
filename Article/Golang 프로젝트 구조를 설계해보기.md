
ìµœê·¼ì— Golangìœ¼ë¡œ ì‚¬ì´ë“œ í”„ë¡œì íŠ¸ë¥¼ í•˜ë‚˜ ì‹œì‘í–ˆë‹¤. ì‹¤ì œë¡œ Golangìœ¼ë¡œ ë³¸ê²©ì ì¸ í”„ë¡œì íŠ¸ë¥¼ ì§„í–‰í•´ ë³¸ ì ì€ ì²˜ìŒì´ì—ˆê¸°ì— í”„ë¡œì íŠ¸ ì„¸íŒ…ë¶€í„° ë§ì€ ë‚œê´€ì´ ìˆì—ˆë‹¤. ê·¸ì¤‘ ê°€ì¥ ì–´ë ¤ì› ë˜ ê²ƒì€ 'í”„ë¡œì íŠ¸ êµ¬ì¡° ì„¤ê³„'ì˜€ë‹¤. (ê·¸ë¦¬ê³  ì§€ê¸ˆë„ ì—¬ì „íˆ ê³ ë¯¼ ì¤‘ì´ë‹¤..)

Golangê³¼ Golangì˜ ì—¬ëŸ¬ ì›¹ ë¼ì´ë¸ŒëŸ¬ë¦¬ë“¤ (gin, echo, fiber, í˜¹ì€ ê¸°ë³¸ ë¼ì´ë¸ŒëŸ¬ë¦¬ ë“±ë“±)ì€ í”„ë¡œì íŠ¸ êµ¬ì¡°ë¥¼ ê°•ì œí•˜ì§€ ì•ŠëŠ”ë‹¤. Handlerë¥¼ í”„ë¡œì íŠ¸ì— ì–´ë””ì— ìœ„ì¹˜ ì‹œí‚¬ì§€, ì–´ë–¤ ì‹ìœ¼ë¡œ ë¼ìš°í„°ë¥¼ ì·¨í•©í•´ì„œ ì„œë²„ë¥¼ ì‹¤í–‰ì‹œí‚¬ì§€ëŠ” ì „ì ìœ¼ë¡œ ì‚¬ìš©ìì˜ ì†ì— ë‹¬ë ¤ìˆë‹¤. ê·¸ë¦¬ê³  Golangì˜ í”„ë¡œì íŠ¸ êµ¬ì¡°ì— ëŒ€í•´ ì—¬ëŸ¬ ì•„í‹°í´ì„ ì°¾ì•„ ë³¸ ê²°ê³¼, ì‚¬ëŒë“¤ì´ ê´€ìŠµì ìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ” êµ¬ì¡°ëŠ” ìˆì–´ë„ ëšœë ·í•œ 'ì •ë‹µ'ì€ ì—†ì—ˆë‹¤. í”„ë¡œì íŠ¸ì˜ êµ¬ì¡°ëŠ” ì „ì ìœ¼ë¡œ í”„ë¡œì íŠ¸ì˜ ì„±ê²©, ìŠ¤í™ì— ë‹¬ë ¤ìˆê³  ê·¸ í”„ë¡œì íŠ¸ì— ë§ëŠ” êµ¬ì¡°ë¥¼ ì„¤ê³„í•´ì•¼ í•˜ëŠ” ê²ƒì€ ì˜¤ë¡¯ì´ ê°œë°œìì˜ ëª«ì´ë‹¤.

ì´ ê¸€ì€ ì‚¬ì´ë“œ í”„ë¡œì íŠ¸ë¥¼ ë§Œë“¤ì–´ë³´ë©´ì„œ ë‚´ê°€ ë‚˜ë¦„ëŒ€ë¡œ í”„ë¡œì íŠ¸ êµ¬ì¡°ì— ëŒ€í•´ ê³ ë¯¼í•˜ê³  ì™œ ì´ë ‡ê²Œ êµ¬ì„±í–ˆëŠ”ì§€ ì •ë¦¬í•´ ë³´ê¸° ìœ„í•´ ì“°ì˜€ë‹¤. ë‹¹ì—°íˆ ì´ ê¸€ì— ë‚˜ì˜¨ í”„ë¡œì íŠ¸ ì„¤ê³„ê°€ ì •ë‹µì´ë¼ê³  ìƒê°í•˜ì§€ ì•Šê³ , ì•„ë§ˆ Golangì„ ì‹¤ì œë¡œ í˜„ì—…ì—ì„œ ì“°ì‹œëŠ” ë¶„ë“¤ ì…ì¥ì—ì„œëŠ” ê°¸ìš°ëš±í• ë§Œí•œ í¬ì¸íŠ¸ë“¤ë„ ë§ì„ ê²ƒì´ë¼ê³  ìƒê°í•œë‹¤. ê·¸ëŸ¼ì—ë„ í”„ë¡œì íŠ¸ë¥¼ ì„¤ê³„í•˜ë©´ì„œ ê°€ì¡Œë˜ ì—¬ëŸ¬ ìƒê°ë“¤ì„ ê³µìœ í•˜ëŠ” ê²ƒì€ ê½¤ ê´œì°®ì€ ì¼ì´ë¼ê³  ìƒê°í•˜ê³ , ë‚˜ì¤‘ì— ë˜ ë‹¤ë¥¸ í”„ë¡œì íŠ¸ë¥¼ ì‹œì‘í•  ë•Œ ë” ë°œì „ì‹œí‚¬ ìˆ˜ ìˆëŠ” ê¸°íšŒê°€ ë  ê²ƒì´ë¼ê³  ìƒê°í•´ì„œ ê¸€ì„ ì“°ê²Œ ë˜ì—ˆë‹¤.

### ê´€ìŠµì—ì„œ ì‹œì‘í•˜ê¸°

ìœ„ì—ì„œë„ ì–¸ê¸‰í–ˆë“¯ Golangì˜ í”„ë¡œì íŠ¸ ì„¤ê³„ì—ëŠ” ì •ë‹µì´ ì—†ë‹¤. í•˜ì§€ë§Œ ë§ì€ Golang ê°œë°œìë“¤ì´ ë”°ë¼ê°€ëŠ” ê´€ìŠµì ì¸ í° í‹€ì€ ì¡´ì¬í•œë‹¤.

https://github.com/golang-standards/project-layout

ìŠ¤íƒ€ê°€ ë¬´ë ¤ 43.5kë‚˜ ì°í˜€ìˆëŠ” ì´ ë ˆí¬ì§€í† ë¦¬ëŠ” ë§ì€ Golang ê°œë°œìë“¤, í˜¹ì€ ì„œì ì´ë‚˜ íŠœí† ë¦¬ì–¼ì—ì„œ ë”°ë¼ê°€ê³  ìˆëŠ” ì¼ë°˜ì ì¸ êµ¬ì¡°ì´ê³  í”„ë¡œì íŠ¸ ì„¤ê³„ì— ì–´ë ¤ì›€ì„ ê²ªê³  ìˆë‹¤ë©´ ì¶©ë¶„íˆ ì°¸ê³  í• ë§Œí•œ ë ˆí¬ì§€í† ë¦¬ì´ë‹¤.

ë¬¼ë¡  ë ˆí¬ì§€í† ë¦¬ì˜ READMEë¥¼ ìì„¸íˆ ì½ì–´ë³´ë©´ ì•Œ ìˆ˜ ìˆë“¯, ì´ ë ˆí¬ì§€í† ë¦¬ì˜ êµ¬ì¡°ê°€ ì™„ì „í•œ 'ì •ë‹µ'ì€ ì•„ë‹ˆë‹¤. READMEì˜ ì„œë‘ë¥¼ ë³´ë©´ ì•Œ ìˆ˜ ìˆë“¯ ì²˜ìŒ Golangì„ ë°°ìš°ëŠ” ì‚¬ëŒë“¤ì€ ë§¤ìš° ì‹¬í”Œí•œ ê²ƒ (ê°€ë ¹ `main.go` í•˜ë‚˜ë¶€í„° ì‹œì‘í•´ ë³´ëŠ” ê²ƒ)ì—ì„œ ì‹œì‘í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤ê³  ì–¸ê¸‰í•˜ê³  ìˆê³ , í”„ë¡œì íŠ¸ê°€ ì»¤ì§€ê³  ê´€ë¦¬ë²•ì´ í•„ìš”í•˜ë‹¤ê³  ì—¬ê²¨ì§ˆ ë•Œ ë„ì…í•´ ë³´ë¼ê³  ì¶”ì²œí•˜ê³  ìˆë‹¤. ê·¸ë¦¬ê³  ê°œë°œí•˜ë©´ì„œ í•„ìš”í•˜ë‹¤ê³  ì—¬ê²¨ì§€ëŠ” ê²ƒë“¤ë§Œ ë‚¨ê¸°ê³  ë‚˜ë¨¸ì§€ëŠ” ì‚­ì œí•´ë„ ë¬´ë°©í•˜ë‹¤ê³  ì–¸ê¸‰í•˜ê³  ìˆë‹¤. ìœ„ì—ì„œë„ ì–¸ê¸‰í–ˆë“¯, Golangì˜ í”„ë¡œì íŠ¸ êµ¬ì¡°ëŠ” í”„ë¡œì íŠ¸ì˜ ì„±ê²©ê³¼ ìŠ¤í™ì— ë”°ë¼ì„œ ë§ì´ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆë‹¤. ê·¸ëŸ¬ë‹ˆ ìœ„ì˜ ë ˆí¬ì§€í† ë¦¬ë‚˜ ì§€ê¸ˆ ë³´ê³  ìˆëŠ” ê¸€ê³¼ ê°™ì´ í”„ë¡œì íŠ¸ ì„¤ê³„ì— ëŒ€í•´ 'ì°¸ê³ ' í•˜ëŠ” ê²ƒì€ ì¢‹ì•„ë„, ì ˆëŒ€ì ì¸ 'ì •ë‹µ'ìœ¼ë¡œ ì—¬ê²¨ì„œëŠ” ì•ˆëœë‹¤ëŠ” ê²ƒì´ë‹¤.

ì—¬ëŸ¬ ì•„í‹°í´, ì„œì , íŠœí† ë¦¬ì–¼ë“¤ì„ ì°¸ê³ í•´ë³¸ ê²°ê³¼ ì£¼ìš”í•˜ê²Œ ì“°ì´ëŠ” êµ¬ì¡°ëŠ” ë‹¤ìŒê³¼ ê°™ì•˜ë‹¤.

### `/cmd`

í”„ë¡œì íŠ¸ì—ì„œ ìµœì¢…ì ìœ¼ë¡œ ì‹¤í–‰ë˜ëŠ” ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë‹´ëŠ” ë””ë ‰í† ë¦¬ì´ë‹¤. cmd í´ë”ì— ë¼ìš°í„°ë‚˜ í•¸ë“¤ëŸ¬ë¥¼ ë„£ëŠ” ê²½ìš°ë„ ë´¤ëŠ”ë°, ê°œì¸ì ìœ¼ë¡œ ìƒê°í•˜ê¸°ì—ëŠ” cmd í´ë”ì— ë‹´ê²¨ìˆëŠ” íŒŒì¼ì€ ìµœëŒ€í•œ ì‘ê²Œ ìœ ì§€í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤ê³  ìƒê°í•œë‹¤. ì½”ë“œê°€ ì§€ë‚˜ì¹˜ê²Œ ë‚œì¡í•´ì§ˆ ìˆ˜ë„ ìˆê³ , ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì£¼ìš”í•œ ë¡œì§ì„ ë‹´ëŠ” ê²ƒì€ cmd í´ë”ì˜ ì·¨ì§€ì™€ëŠ” ë§ì§€ ì•ŠëŠ”ë‹¤ê³  ìƒê°í•˜ê¸° ë•Œë¬¸ì´ë‹¤.

### `/internal`

internal í´ë”ì—ëŠ” ë‹¤ë¥¸ ì‚¬ëŒë“¤ì´ ì„í¬íŠ¸ í•˜ê¸° ì›ì¹˜ ì•ŠëŠ” ì£¼ìš”í•œ ì• í”Œë¦¬ì¼€ì´ì…˜ ì½”ë“œë“¤ì´ ë“¤ì–´ê°€ë©´ ì¢‹ë‹¤. ì£¼ë¡œ í•µì‹¬ì ì¸ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì´ë‚˜ ê·¸ í”„ë¡œì íŠ¸ ìì²´ì—ì„œë§Œ ì“°ì´ëŠ” ì½”ë“œë“¤ì„ internal í´ë”ì— ë„£ì–´ì„œ ì •ë¦¬í•˜ë©´ í”„ë¡œì íŠ¸ì˜ êµ¬ì¡°ê°€ ë§¤ìš° ê¹”ë”í•´ì§„ë‹¤. internal í´ë”ëŠ” `Go 1.4` ë¶€í„° ì»´íŒŒì¼ëŸ¬ê°€ ìºì¹˜ í•  ìˆ˜ ìˆë„ë¡ ë˜ì—ˆê¸° ë•Œë¬¸ì— í”„ë¡œì íŠ¸ì— internal ë””ë ‰í† ë¦¬ë¥¼ ë„£ëŠ” ê²ƒì€ ê½¤ ê³ ë ¤í•´ë³¼ ë§Œí•œ ì¼ì´ë‹¤.

### `/pkg`

pkg í´ë”ëŠ” internalê³¼ ë°˜ëŒ€ë¡œ ì™¸ë¶€ì—ì„œ ì‚¬ìš©í•´ë„ ê´œì°®ì€ ì½”ë“œë“¤ì´ ë“¤ì–´ê°€ë©´ ì¢‹ë‹¤.

### í”„ë¡œì íŠ¸ ì†Œê°œë¥¼ ì‹œì‘í•˜ê¸° ì „ì—

ì•„ë˜ì— ì„œìˆ ë  í”„ë¡œì íŠ¸ëŠ” [Puddlee backend](https://github.com/PUDDLEEE/puddleee_back/tree/feat/17/auth) ì—ì„œ ë³¼ ìˆ˜ ìˆë‹¤.

í•´ë‹¹ í”„ë¡œì íŠ¸ì—ì„œ ì“°ì¸ ë¼ì´ë¸ŒëŸ¬ë¦¬ë“¤ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.

- [Cobra](https://github.com/spf13/cobra)- CLI íˆ´
- [Viper](https://github.com/spf13/viper)- configuration íˆ´
- [Gin](https://github.com/gin-gonic/gin) - http ë¼ì´ë¸ŒëŸ¬ë¦¬
- [ent](https://entgo.io/)- ë°ì´í„°ë² ì´ìŠ¤ ORM
- [mockery](https://github.com/vektra/mockery)- í…ŒìŠ¤íŒ…ì„ ìœ„í•œ mocking íˆ´
- [swag](https://github.com/swaggo/swag)- Golangì„ ìœ„í•œ swagger ë¼ì´ë¸ŒëŸ¬ë¦¬

### í”„ë¡œì íŠ¸ ì‹œì‘ì 

ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì–´ë–»ê²Œ ì‹œì‘í•˜ë©´ ì¢‹ì„ê¹Œ? í•„ìëŠ” ìœ„ì—ì„œë„ ì–¸ê¸‰í–ˆë“¯ cmd ë””ë ‰í† ë¦¬ë¥¼ ë¹„ë¡¯í•œ í”„ë¡œì íŠ¸ì˜ ì—”íŠ¸ë¦¬ í¬ì¸íŠ¸ëŠ” ìµœëŒ€í•œ ì‘ê²Œ ìœ ì§€í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤ê³  ìƒê°í•œë‹¤. ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì‹¤í–‰ë  `main.go`ì™€ cmd ë””ë ‰í† ë¦¬ëŠ” ì „ì ìœ¼ë¡œ í”„ë¡œê·¸ë¨ì´ ì‹¤í–‰ë  ë¡œì§ë“¤ë§Œ ë‹´ëŠ” ê²ƒì´ ì¢‹ë‹¤ê³  ìƒê°í•´ì„œ, í•´ë‹¹ í”„ë¡œì íŠ¸ì˜ `main.go`ì™€ cmd ë””ë ‰í† ë¦¬ëŠ” ë§¤ìš° ì‹¬í”Œí•˜ê²Œ ê´€ë¦¬ë˜ê³  ìˆë‹¤.

**main.go**
```go
package main

import (
	"github.com/PUDDLEEE/puddleee_back/cmd"
	_ "github.com/PUDDLEEE/puddleee_back/docs"
)
//...

func main() {
	cmd.Execute()
}
```

Execute ë©”ì†Œë“œëŠ” Cobra ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ í™œìš©í•´ì„œ CLI ì»¤ë§¨ë“œë¥¼ í˜¸ì¶œí•  ìˆ˜ ìˆë„ë¡ ë§Œë“¤ì–´ì ¸ ìˆë‹¤. cmd ë””ë ‰í† ë¦¬ ì•ˆì— `root.go` ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì„¤ëª…ì„ (ì¼ë°˜ì ì¸ -h, -help í”Œë˜ê·¸ì™€ ê°™ì´) , `serve.go`ëŠ” ì‹¤ì œë¡œ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì‹¤í–‰ë  ì»¤ë§¨ë“œë¥¼ ë‹´ê³  ìˆë‹¤.

**root.go**
```go
package cmd

import "github.com/spf13/cobra"

var rootCmd = &cobra.Command{
	Use:   "puddlee",
	Short: "Puddlee is a Chat Service for developer.",
}

func init() {
	rootCmd.AddCommand(serveCmd)
}

func Execute() error {
	return rootCmd.Execute()
}
```

**serve.go**
```go
package cmd

import (
	"github.com/PUDDLEEE/puddleee_back/internal/app"
	"github.com/spf13/cobra"
)

var serveCmd = &cobra.Command{
	Use:   "serve",
	Short: "Run Puddlee Backend Server",
	Long: `Run Puddlee Backend Server on local.
	configuration file lies on the config directory.`,
	Run: func(cmd *cobra.Command, args []string) {
		app.InitApp()
	},
}
```

`serve.go` ì½”ë“œë¥¼ ì‚´í´ë³´ë©´, `app.InitApp()` ìœ¼ë¡œ í”„ë¡œì íŠ¸ê°€ ì‹¤í–‰ì´ ë˜ê³  ìˆë‹¤ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆë‹¤. `app` íŒ¨í‚¤ì§€ëŠ” internal ë””ë ‰í† ë¦¬ ì•ˆì— ìˆê³ , ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì‹¤í–‰ë  ìˆ˜ ìˆë„ë¡ ê°ì¢… ì„¤ì • (db ì„¤ì •, ë¼ìš°í„° ì„¤ì • ë“±ë“±...) ì„ ê´€ë¦¬í•˜ëŠ” ì—­í• ì„ í•˜ê³  ìˆë‹¤.

### ì´ ë§ì€ íŒ¨í‚¤ì§€ë“¤ì„ ì–´ë–»ê²Œ í•œë° ë¬¶ì–´ì•¼ í• ê¹Œ?

í˜„ì¬ êµ¬í˜„ì¤‘ì¸ í”„ë¡œì íŠ¸ì—ì„œ, internal í´ë”ì˜ êµ¬ì¡°ëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.

```
ğŸ“‚internal
â”£ ğŸ“‚ app
â”£ ğŸ“‚ auth
â”£ ğŸ“‚ db
â”£ ğŸ“‚ errors
â”£ ğŸ“‚ interceptors
â”£ ğŸ“‚ jwtAuth
â”£ ğŸ“‚ mail
â”£ ğŸ“‚ middlewares
â”£ ğŸ“‚ room
â”— ğŸ“‚ users
```

í´ë”ë§Œ ë´ë„ ì•Œ ìˆ˜ ìˆë“¯, internal ë””ë ‰í† ë¦¬ì—ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ê°€ì¥ í•µì‹¬ì ì¸ ë¡œì§ë“¤ì´ ë‹´ê²¨ìˆë‹¤. ì´ ë§ì€ íŒ¨í‚¤ì§€ë“¤ì„ ì–´ë–»ê²Œ í•œë° ë¬¶ì–´ì„œ ì‹¤í–‰ì‹œí‚¬ ìˆ˜ ìˆì„ê¹Œ?

![[golang-project.drawio.png]]

í•µì‹¬ì€ íŒ¨í‚¤ì§€ë“¤ì´ `InitXXX()` ë¡œ initializing ë˜ê³  ìˆê³ , ëª¨ë“  íŒ¨í‚¤ì§€ë“¤ì´ App ìœ¼ë¡œ ì „ë‹¬ë˜ê³  ìˆëŠ” êµ¬ì¡°ë¼ëŠ” ê²ƒì´ë‹¤. Appì—ì„œëŠ” Config, Routes, DB ë¥¼ ê´€ë¦¬í•˜ê¸° ìœ„í•´ ë”°ë¡œ structë¥¼ ë§Œë“¤ì–´ ê´€ë¦¬í•˜ê³ , ë©”ì†Œë“œ `InitApp()` ìœ¼ë¡œ ì„œë²„ë¥¼ ì‹¤í–‰ì‹œí‚¤ëŠ” êµ¬ì¡°ë¥¼ ì„¤ê³„í–ˆë‹¤.

Application structì˜ êµ¬ì¡°ëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.

```go
type Application struct {
	Routes Routes
	Config *config.Config
	Client *ent.Client
}
```

ì´ëŸ° ì‹ìœ¼ë¡œ structë¥¼ ë§Œë“¤ê²Œ ë˜ë©´, ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì „ë°˜ì ì¸ ì„¤ì •ì„ ê´€ë¦¬í•˜ê¸° ì‰¬ì›Œì§€ê²Œ ëœë‹¤. ì–´ë–¤ ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ Application struct ë‚´ì˜ Configë‚˜ Clientë¥¼ í•„ìš”ë¡œ í•  ê²½ìš° ê·¸ í•„ë“œë¥¼ ì¸ìë¡œ ë„˜ê¸¸ìˆ˜ ìˆê²Œ ëœë‹¤. í•´ë‹¹ ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ `initConfig`ë‚˜ `initDB` ë“±ì„ ë²ˆê±°ë¡­ê²Œ í˜¸ì¶œí•  í•„ìš”ì„±ì´ ì—†ì–´ì§€ê³ , dependencyì— ê´€í•œ ê´€ë¦¬ê°€ ë” ì‰¬ì›Œì§€ê²Œ ëœë‹¤.

`internal/app/init.go`ì€ ìœ„ì—ì„œ ì„¤ëª…í•œ ì ì„ êµ¬í˜„í•˜ê³  ìˆë‹¤.

**internal/app/init.go**
```go
package app

import (
	"fmt"
	"net/http"

	"github.com/PUDDLEEE/puddleee_back/internal/db"
	"github.com/PUDDLEEE/puddleee_back/pkg/config"
)

func InitApp() {
	app := &Application{
		Config: config.InitConfig(),
	}
	app.Client = db.InitDB()
	defer app.Client.Close()
	app.initRoutes()
	app.run()
}

func (app *Application) run() {
	addr := fmt.Sprintf("%s:%d", app.Config.Server.Host, app.Config.Server.Port)
	srv := &http.Server{
		Addr:    addr,
		Handler: app.Routes.Router,
	}
	srv.ListenAndServe()
}
```


### Singleton íŒ¨í„´ìœ¼ë¡œ íŒ¨í‚¤ì§€ initializing í•˜ê¸°

ìœ„ì˜ ê·¸ë˜í”„ì—ì„œ ë³´ë“¯ Config, DB, RoutesëŠ” `InitXXX()`ë¡œ ì´ˆê¸°í™” ë˜ê³  ìˆë‹¤. ê°ê°ì˜ íŒ¨í‚¤ì§€ëŠ” ì•±ì„ ì‹¤í–‰í• ë•Œ ë‹¨ í•œë²ˆë§Œ initialize ë˜ì•¼í•˜ëŠ” ìƒí™©ì´ë‹¤. ì´ëŸ¬í•œ ìƒí™©ì—ì„œ Singleton íŒ¨í„´ë³´ë‹¤ ë” ì ì ˆí•œ íŒ¨í„´ì€ ì—†ì–´ë³´ì¸ë‹¤.

Golangì—ì„œ Singleton íŒ¨í„´ì€ `sync` íŒ¨í‚¤ì§€ë¥¼ ì´ìš©í•´ êµ¬í˜„ í•  ìˆ˜ ìˆë‹¤. `sync.Once` íƒ€ì…ì„ ì´ìš©í•˜ë©´ ì• í”Œë¦¬ì¼€ì´ì…˜ ë‚´ì—ì„œ ì–´ë–¤ ìƒí™©ì„ ë‹¨ í•œë²ˆë§Œ í˜¸ì¶œí•  ìˆ˜ ìˆë„ë¡ ë„ì›€ ë°›ì„ ìˆ˜ ìˆë‹¤.

**internal/app/routes.go**

```go
package app

//...

var once sync.Once
var routes Routes

func (app *Application) initRoutes() {
	if routes.Router == nil {
		once.Do(func() {
			app.setRoutes()
		})
	} else {
		log.Fatal("Router already configure")
	}
	app.Routes = routes
}

//...
```

Configì˜ initializeëŠ” ì´ë ‡ê²Œ êµ¬í˜„ë˜ì—ˆë‹¤.

**pkg/config/config.go**

```go
package config

import (
	"log"
	"sync"

	"github.com/spf13/viper"
)

var once sync.Once

var config *Config

func InitConfig() *Config {
	if config == nil {
		once.Do(func() {
			err := setConfig()
			if err != nil {
				log.Fatal(err)
			}
		})
	} else {
		log.Fatal("Config already set.")
	}
	return config
}

func setConfig() error {
	viper.AddConfigPath("./config")
	viper.SetConfigType("yaml")
	if err := viper.ReadInConfig(); err != nil {
		return err
	}
	if err := viper.Unmarshal(&config); err != nil {
		return err
	}
	return nil
}

```

ê·¸ë¦¬ê³  Application structì˜ í•„ë“œë¥¼ í™œìš©í•´ì„œ ì»¨íŠ¸ë¡¤ëŸ¬ë“¤ì„ initalize í• ìˆ˜ë„ ìˆë‹¤. ì•„ë˜ì˜ ì½”ë“œì—ì„œëŠ” `setRoutes()` ë¥¼ `Application` ì˜ ë©”ì†Œë“œë¡œ ë§Œë“¤ì–´ì„œ, Application struct ì•ˆì— ìˆëŠ” í•„ë“œë“¤ì„ í™œìš© í•  ìˆ˜ ìˆë„ë¡ ë§Œë“¤ì—ˆë‹¤. ë‹¤ë§Œ ì•„ë˜ ì½”ë“œëŠ” ë” ê¹”ë”í•˜ê²Œ ì²˜ë¦¬í•  ì—¬ì§€ê°€ ìˆì–´ì„œ ì¢€ ë” ë¦¬íŒ©í† ë§ì´ í•„ìš”í•œ ìƒí™©ì´ë‹¤.

```go
// ...
func (app *Application) setRoutes() {
	routes.Router = gin.Default()
	routes.Router.Use(middlewares.ErrorHandler())
	routes.Router.Use(cors.Default())
	v1 := routes.Router.Group("/api/v1")
	userController := user.InitializeController(context.Background(), app.Client)
	roomController := room.InitializeController(context.Background(), app.Client)

	mailParams := &mail.MailServiceParams{}
	mailParams.From = app.Config.Mail.From
	mailParams.Port = app.Config.Mail.Port
	mailParams.Server = app.Config.Mail.Server
	mailParams.Password = app.Config.Mail.Password

	authController := auth.InitializeController(context.Background(), app.Client, app.Config.Jwt.SecretKey, *mailParams)
	routes.addSwagger(v1)
	routes.addUser(v1, userController)
	routes.addRoom(v1, roomController)
	routes.addAuth(v1, authController)
}

//...
```


### Service, Controller, Repository êµ¬ì¡°

Service, Controller, Repository êµ¬ì¡°ë¥¼ ì±„íƒí•´ì„œ ì–»ëŠ” ì´ì ì€, ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì— ëŒ€í•´ ê´€ì‹¬ì‚¬ë¥¼ ë¶„ë¦¬ì‹œì¼œ ë” ìœ ì§€ë³´ìˆ˜ ê°€ëŠ¥í•œ ì½”ë“œë¥¼ ì‘ì„± ê°€ëŠ¥í•˜ë‹¤ëŠ” ê²ƒì´ë‹¤.

- Repository: DBì—ì„œ ë°ì´í„°ë¥¼ ê°€ê³µí•˜ëŠ” ì—­í• 
- Service: í•µì‹¬ì ì¸ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ë‹´ëŠ” ì—­í• 
- Controller: ì‹¤ì œë¡œ APIê°€ í˜¸ì¶œë ë•Œ ì—ëŸ¬ í•¸ë“¤ë§ ë“±ì„ ë‹´ë‹¹í•˜ëŠ” ì—­í• 

User, Room, Auth.. ì™€ ê°™ì€ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ êµ¬ì¡°ëŠ” ëª¨ë‘ ì•„ë˜ì™€ ê°™ì´ ë™ì¼í•˜ë‹¤.

```
ğŸ“‚ user
â”£ ğŸ“‚ dto
â”£ ğŸ“ controller.go
â”£ ğŸ“ controller_test.go
â”£ ğŸ“ initController.go
â”£ ğŸ“ repository.go
â”£ ğŸ“ repository_test.go
â”£ ğŸ“ service.go
â”— ğŸ“ service_test.go
```

Controller, Service, Repository ì— ëŒ€í•œ dependencyëŠ” `initController.go` ì—ì„œ ì²˜ë¦¬í•˜ê³  ìˆë‹¤.

**internal/user/initController.go**
```go
func InitializeController(ctx context.Context, client *ent.Client) *UserController {
	userRepository := NewUserRepository()
	userService := NewService(userRepository, ctx, client)
	userController := NewController(userService)
	return userController
}
```

ì—¬ê¸°ì„œ `NewService()`, `NewController()` ì—ì„œëŠ” ì§ì ‘ì ìœ¼ë¡œ structë¥¼ ë°›ì§€ ì•ŠëŠ”ë‹¤. ì™œëƒí•˜ë©´ í…ŒìŠ¤íŒ…ì„ ìœ„í•´ì„œ mockingí•œ ì¸ìë¥¼ ë°›ì•„ì•¼ í•  ìˆ˜ë„ ìˆê¸° ë•Œë¬¸ì´ë‹¤. ê·¸ë˜ì„œ ëŒ€ì‹  `pkg/interfaces` ì— ì„ ì–¸ëœ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì¸ìë¡œ ë°›ê³ , Type Assertionì„ í†µí•´ ë°œìƒí•  ìˆ˜ ìˆëŠ” ì—ëŸ¬ë¥¼ ì²˜ë¦¬í•´ì£¼ê³  ìˆë‹¤.

**internal/user/service.go**
```go
func NewService(repo interfaces.IUserRepository, ctx context.Context, client *ent.Client) *UserService {
	if userRepository, ok := repo.(*UserRepository); ok {
		return &UserService{userRepository: userRepository, ctx: ctx, client: client}
	}

	if userRepository, ok := repo.(*mocks.IUserRepository); ok {
		return &UserService{userRepository: userRepository, ctx: ctx, client: client}
	}
	return nil
}
```

**pkg/interfaces/IUserRepository.go**
```go
package interfaces

import (
	"context"

	"github.com/PUDDLEEE/puddleee_back/ent"
	userdto "github.com/PUDDLEEE/puddleee_back/internal/user/dto"
)

type IUserRepository interface {
	Create(context.Context, *ent.Client, userdto.CreateUserDTO) (*ent.User, error)
	FindOneById(context.Context, *ent.Client, int) (*ent.User, error)
	FindOneByEmail(context.Context, *ent.Client, string) (*ent.User, error)
	Update(context.Context, *ent.Client, int, userdto.UpdateUserDTO) (*ent.User, error)
	Delete(context.Context, *ent.Client, int) error
}
```

Service, Repositoryì— ëª…ì‹œëœ ë©”ì†Œë“œë“¤ì€ `pkg/interfaces` ì—ì„œ ì •ì˜ëœ ì¸í„°í˜ì´ìŠ¤ì˜ êµ¬ì¡°ì²´ë¥¼ ë”°ë¥´ê³  ìˆê³ , ì´ë¥¼ Decorator íŒ¨í„´ì´ë¼ê³  í•œë‹¤. ì•ì„œ ë§í–ˆë“¯ ë³¸ë˜ ì¸ìì™€ í…ŒìŠ¤íŒ…ì„ ìœ„í•œ mockingí•œ ì¸ì ëª¨ë‘ ë°›ì•„ì•¼ í•˜ê¸° ë•Œë¬¸ì— ì´ë¥¼ ìœ„í•´ì„œ Decorator íŒ¨í„´ì„ ì ìš©í–ˆë‹¤.

### ê²°ë¡ 

ì•„ì§ í”„ë¡œì íŠ¸ëŠ” ì™„ì„±ë˜ì§€ ì•Šì•˜ì§€ë§Œ, ì•½ 1~2ì£¼ê°„ì˜ ê¸°ê°„ë™ì•ˆ í”„ë¡œì íŠ¸ë¥¼ ì„¸íŒ…í•˜ë©´ì„œ ì–´ë–»ê²Œ í•˜ë©´ ë” ê´œì°®ì€ êµ¬ì¡°ë¡œ êµ¬ì„±í•  ìˆ˜ ìˆì„ì§€ ê³ ë¯¼í–ˆê³  ê²°ë¡ ì ìœ¼ë¡œ ì§€ê¸ˆ ê¹Œì§€ ë‚˜ì˜¨ ê²°ê³¼ë¬¼ì— ë§Œì¡±í•œë‹¤!

ë¬¼ë¡  ë” ë‚˜ì•„ì§ˆ ìˆ˜ ìˆëŠ” ì—¬ì§€ê°€ ìˆê² ì§€ë§Œ ì½”ë“œë¥¼ ëª…í™•í•˜ê²Œ ê´€ì‹¬ì‚¬ëŒ€ë¡œ ë¶„ë¦¬í•  ìˆ˜ ìˆì—ˆê³ , í”„ë¡œì íŠ¸ì˜ í™•ì¥ì„±ë„ ìš©ì´í•´ì„œ ê½¤ ë§Œì¡±ìŠ¤ëŸ½ê²Œ ê°œë°œ í•  ìˆ˜ ìˆì—ˆë‹¤.

í•˜ì§€ë§Œ ì—¬ê¸°ì„œ ëì´ ì•„ë‹ˆë¼ê³  ìƒê°í•˜ê³ , ë” í”„ë¡œì íŠ¸ êµ¬ì¡°ì— ê´€í•œ ìë£Œë¥¼ ì°¾ì•„ë³´ë©´ì„œ ê°œì„  ë°©í–¥ì„ ì°¾ì•„ë³¼ê²ƒì´ë‹¤.